# 自定义注解 

## 一、自定义注解使用场景
登陆、权限拦截、日志处理，以及各种 Java 框架，如 Spring，Hibernate，JUnit。
提到注解就不能不说反射，Java 自定义注解是通过运行时靠反射获取注解。
实际开发中，例如我们要获取某个方法的调用日志，可以通过 AOP（动态代理机制）给方法添加切面，通过反射来获取方法包含的注解，如果包含日志注解，就进行日志记录。
反射的实现在 Java 应用层面上讲，是通过对 Class 对象的操作实现的，Class 对象为我们提供了一系列方法对类进行操作。

### 1、 登陆、权限拦截
在web项目中，登陆拦截和权限拦截是一个老生常谈的功能。通过自定义登陆注解或权限注解，在自定义拦截器中解析注解，实现登陆和权限的拦截功能。

这种使用方式，配置简单，灵活度高，代码耦合度低。

### 2、 定时任务管理
在系统构建过程中，会有各种定时任务的需求，而定时任务的集中管理，可以更高效维护系统的运行。

通过Java注解官方文档Repeating Annotations章节中的自定义的定时任务注解，可以实现业务方法的定时任务声明。结合Spring的容器后处理器BeanPostProcessor（ps：Spring容器后处理器下篇再说），解析自定义注解。解析后的注解信息再使用Quartz API构建运行时定时任务，即可完成定时任务的运行时创建和集中管理。

这种方式能避免定义Quartz定时任务的配置，提高系统扩展性。

### 3、 多数据源路由的数据源指定
Spring提供的AbstractRoutingDataSource实现多数据源的动态路由，可应用在主从分离的架构下。通过对不同的方法指定不同的数据源，实现数据源的动态路由（例如：读方法走从库数据源，写方法走主库数据源）。而如何标识不同的方法对应的数据源类型，则可使用自定义注解实现。通过解析方法上声明的自定义注解对应的数据源类型，实现数据源的路由功能。

这种方式避免了对方法的模式匹配解析（例如：select开头、update开头等），声明更加灵活。



二、参考博客
1、深入Spring:自定义注解加载和使用
https://www.jianshu.com/p/7c2948f64b1c

2、Spring自定义注解的使用和解析
https://www.jianshu.com/p/9d4bd8955d1a









